# System Change Proposal Structure

**Purpose:** Define the structure of proposals generated by the System Analyzer Daemon for human review.

---

## Overview

When the System Analyzer Daemon processes flagged changes, it generates a **Proposal** - a rich, evidence-based document that helps humans decide whether to approve a system change. Proposals include:
- What change is being proposed
- Why it's needed (evidence and rationale)
- How many times it's been flagged
- Suggested documentation structure
- Information to support decision-making

---

## Proposal Structure

```
{
  proposal_id: string,                // Unique identifier (e.g., "prop_20251104_001")
  proposal_type: string,              // Type of change (new_action_type, new_tool, tool_enhancement, capability_gap)
  
  // Basic information
  title: string,                      // Short title (e.g., "New Action Type: parallel_task")
  description: string,                // What is being proposed
  rationale: string,                  // Why this change is needed
  
  // Evidence and frequency
  evidence: {
    total_flags: number,              // How many times flagged
    first_flagged: ISO8601,           // When first flagged
    last_flagged: ISO8601,            // When last flagged
    severity_distribution: {
      info: number,
      warning: number,
      critical: number
    },
    source_daemons: string[],         // Which daemons flagged this
    affected_turns: string[],         // Turn IDs where this was flagged
    affected_users?: string[],        // User IDs (if applicable)
    use_cases: string[]               // Different scenarios where this is needed
  },
  
  // Detailed information to support decision-making
  details: {
    // Varies by proposal_type (see examples below)
  },
  
  // Suggested documentation
  suggested_documentation: {
    // Structure and hints for what documentation should look like
    // (filled in by System Analyzer to help human write docs)
  },
  
  // Deduplication and status
  related_proposals?: string[],       // IDs of similar proposals (if any)
  status: "pending" | "approved" | "rejected" | "implemented",
  
  // Metadata
  created_at: ISO8601,
  created_by: "system_analyzer",
  reviewed_by?: string,               // Human who reviewed
  reviewed_at?: ISO8601,
  review_notes?: string,
  
  // Implementation tracking
  implementation_pr?: string,         // Link to PR if approved
  implementation_status?: "pending" | "in_progress" | "completed"
}
```

---

## Proposal Types and Details

### 1. `new_action_type`

```
details: {
  action_type_name: string,
  description: string,
  suggested_policies: {
    requires_confirmation?: boolean,
    auto_complete?: boolean,
    blocking?: boolean,
    escalation?: {
      after?: string,                 // Duration (e.g., "1h")
      policy?: string
    }
  },
  suggested_statuses?: string[],      // Allowed statuses for this type
  suggested_transitions?: object,     // State transitions
  examples: [
    {
      scenario: string,               // When this action type would be used
      turn_id: string,                // Example from actual turn
      context: string
    }
  ]
}
```

### 2. `new_tool`

```
details: {
  tool_name: string,
  tool_purpose: string,
  use_cases: [
    {
      scenario: string,
      turn_id: string,
      why_needed: string
    }
  ],
  suggested_inputs: [
    {
      name: string,
      type: string,
      description: string,
      required: boolean
    }
  ],
  suggested_outputs: [
    {
      name: string,
      type: string,
      description: string
    }
  ],
  integration_points?: string[],      // Which daemons would use this
  similar_tools?: string[]            // Existing tools that are similar
}
```

### 3. `tool_enhancement`

```
details: {
  tool_name: string,
  current_capabilities: string[],
  enhancement: string,
  why_needed: string,
  examples: [
    {
      scenario: string,
      turn_id: string,
      current_limitation: string,
      how_enhancement_helps: string
    }
  ],
  suggested_new_inputs?: [
    {
      name: string,
      type: string,
      description: string
    }
  ],
  suggested_new_outputs?: [
    {
      name: string,
      type: string,
      description: string
    }
  ],
  backward_compatibility?: string     // Will this break existing usage?
}
```

### 4. `capability_gap`

```
details: {
  capability_name: string,
  description: string,
  affected_daemons: string[],
  use_cases: [
    {
      scenario: string,
      turn_id: string,
      why_needed: string
    }
  ],
  implementation_options?: [
    {
      option: string,
      pros: string[],
      cons: string[]
    }
  ]
}
```

---

## Example Proposal

```json
{
  "proposal_id": "prop_20251104_001",
  "proposal_type": "new_action_type",
  "title": "New Action Type: parallel_task",
  "description": "Execute multiple tasks in parallel and wait for all to complete",
  "rationale": "Users frequently need to run multiple independent tasks simultaneously. Current action types only support sequential execution.",
  
  "evidence": {
    "total_flags": 3,
    "first_flagged": "2025-11-01T10:00:00Z",
    "last_flagged": "2025-11-04T15:45:00Z",
    "severity_distribution": {
      "info": 1,
      "warning": 2,
      "critical": 0
    },
    "source_daemons": ["frontal_cortex"],
    "affected_turns": ["turn_20251101_042", "turn_20251103_015", "turn_20251104_043"],
    "affected_users": ["user_123", "user_456"],
    "use_cases": [
      "Run 5 research tasks simultaneously",
      "Execute parallel data processing",
      "Concurrent API calls"
    ]
  },
  
  "details": {
    "action_type_name": "parallel_task",
    "description": "Execute multiple tasks in parallel and wait for all to complete",
    "suggested_policies": {
      "requires_confirmation": false,
      "auto_complete": true,
      "blocking": false
    },
    "examples": [
      {
        "scenario": "User asked to research 5 topics simultaneously",
        "turn_id": "turn_20251104_043",
        "context": "User wanted faster research completion"
      }
    ]
  },
  
  "suggested_documentation": {
    "file_path": "documentation/frontal-cortex/action-types/parallel_task.md",
    "sections": [
      "Overview: What parallel_task does",
      "Use Cases: When to use this action type",
      "Policies: Default behavior and configuration",
      "Examples: Real examples from turns",
      "Transitions: Valid state transitions",
      "Test Conditions: How to verify it works"
    ]
  },
  
  "status": "pending",
  "created_at": "2025-11-04T16:00:00Z",
  "created_by": "system_analyzer"
}
```

---

## Decision Support Information

Proposals include rich information to help humans decide:

1. **Evidence**: How many times flagged, severity, which daemons, which users
2. **Use Cases**: Real scenarios from actual turns
3. **Examples**: Concrete examples of when this would be used
4. **Integration Points**: Which parts of the system would use this
5. **Suggested Documentation**: Structure to help write docs
6. **Related Proposals**: Similar proposals to avoid duplication

---

## Next Steps

1. Specify Change Flagging Daemon (how it creates flags)
2. Specify System Analyzer Daemon (how it generates proposals)
3. Define test conditions for both daemons

